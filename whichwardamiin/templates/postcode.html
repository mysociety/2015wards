{% extends 'base.html' %}

{% block title %}{{ postcode_display }} â€“ Which ward will I be in?{% endblock %}

{% block postcode_input_value %}{{ postcode_display }}{% endblock %}

{% block content %}
<header class="area_info">
<h2>{{ postcode_display }}</h2>
<p>You'll be in <strong>{% if new_ward %}{{ new_ward.name }}{% else %}{{ old_ward.name }}{% endif %}</strong> ward.<p>
{% if ward_has_changed_area %}
  <p>
    {% if ward_has_changed_names %}
        Your ward will change,
        from {{ old_ward.name }} to {{ new_ward.name }}.
    {% else %}
        Your ward may have changed, please see the map.
    {% endif %}
  </p>
  <p>
    You can try <a href="http://www.lgbce.org.uk/current-reviews">looking at
    the Local Government Boundary Commission's website</a> to see full details
    of any changes, including consultations.
  </p>
{% elif ward_has_changed_names %}
  <p>Your ward has changed name from {{ old_ward.name }} to {{ new_ward.name }}.
{% else %}
  <p>This ward will stay the same, as far as we know.</p>
{% endif %}

  {% if ward_has_changed_area %}
    <p><span style="display:inline-block; width:3em; height:0.75em; background-color:#D4A06A;"></span> Old ward</p>
    <p><span style="display:inline-block; width:3em; height:0.75em; background-color:#265b6a;"></span> New ward</p>
  {% endif %}

</header>

{% if old_ward %}
<h2>{% if ward_has_changed_area %}Ward comparison{% else %}Your ward{% endif %}</h2>
<div id="map"><div id="leaflet"></div></div>
{% endif %}
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% if old_ward %}
  <script>
    var map = new L.Map("leaflet");
    var layer = new L.TileLayer("http://{s}tile.stamen.com/toner-lite/{z}/{x}/{y}.png", {
        "minZoom": 0,
        "maxZoom": 20,
        "subdomains": "a. b. c. d.".split(" ")
    });
    map.attributionControl.setPrefix('');
    map.addLayer(layer);

    function add_json(data, col) {
        var area = new L.GeoJSON(data);
        area.setStyle({color: col, fill: false, opacity: 1});
        map.addLayer(area);
        map.fitBounds(area.getBounds());
    }

    reqwest({
        url: "{% url 'area_polygon' old_ward.id 'geojson' %}?simplify_tolerance=0.0001",
        type: 'json',
        success: function(data) { add_json(data, '#{% if ward_has_changed_area %}D4A06A{% else %}265b6a{% endif %}'); }
    });

    {% if ward_has_changed_area %}
        reqwest({
            url: "{% url 'area_polygon' new_ward.id 'geojson' %}?simplify_tolerance=0.0001",
            type: 'json',
            success: function(data) { add_json(data, '#265B6A'); }
        });
    {% endif %}

  </script>
{% endif %}
{% endblock %}
